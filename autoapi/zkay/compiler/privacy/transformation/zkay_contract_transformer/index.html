<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>zkay.compiler.privacy.transformation.zkay_contract_transformer &mdash; zkay  documentation</title>
      <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../../" id="documentation_options" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../../index.html" class="icon icon-home"> zkay
          </a>
              <div class="version">
                0.3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../language.html">Language Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">zkay</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">zkay.compiler.privacy.transformation.zkay_contract_transformer</span></code></li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="module-zkay.compiler.privacy.transformation.zkay_contract_transformer">
<span id="zkay-compiler-privacy-transformation-zkay-contract-transformer"></span><h1><a class="reference internal" href="#module-zkay.compiler.privacy.transformation.zkay_contract_transformer" title="zkay.compiler.privacy.transformation.zkay_contract_transformer"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zkay.compiler.privacy.transformation.zkay_contract_transformer</span></code></a><a class="headerlink" href="#module-zkay.compiler.privacy.transformation.zkay_contract_transformer" title="Permalink to this headline"></a></h1>
<p>This module provides functionality to transform a zkay AST into an equivalent public solidity AST + proof circuits</p>
<div class="section" id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.transform_ast">
<span class="sig-prename descclassname"><span class="pre">zkay.compiler.privacy.transformation.zkay_contract_transformer.</span></span><span class="sig-name descname"><span class="pre">transform_ast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ast</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.SourceUnit" title="zkay.zkay_ast.ast.SourceUnit"><span class="pre">zkay.zkay_ast.ast.SourceUnit</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.SourceUnit" title="zkay.zkay_ast.ast.SourceUnit"><span class="pre">zkay.zkay_ast.ast.SourceUnit</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ConstructorOrFunctionDefinition" title="zkay.zkay_ast.ast.ConstructorOrFunctionDefinition"><span class="pre">zkay.zkay_ast.ast.ConstructorOrFunctionDefinition</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../../circuit_generation/circuit_helper/index.html#zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper" title="zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper"><span class="pre">zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.transform_ast" title="Permalink to this definition"></a></dt>
<dd><p>Convert zkay to solidity AST + proof circuits</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ast</strong> – zkay AST</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>solidity AST and dictionary which maps all function definitions which require verification
to the corresponding circuit helper instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">zkay.compiler.privacy.transformation.zkay_contract_transformer.</span></span><span class="sig-name descname"><span class="pre">ZkayTransformer</span></span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="../../../../zkay_ast/visitor/transformer_visitor/index.html#zkay.zkay_ast.visitor.transformer_visitor.AstTransformerVisitor" title="zkay.zkay_ast.visitor.transformer_visitor.AstTransformerVisitor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">zkay.zkay_ast.visitor.transformer_visitor.AstTransformerVisitor</span></code></a></p>
<p>Transformer which transforms contract level AST elements (contract, function definitions, constructor definitions)</p>
<p>Contract level transformations:</p>
<ul>
<li><p>Import public key infrastructure contract and make it available as public constant state variable</p></li>
<li><div class="line-block">
<div class="line">Import verification contracts for all functions which require verification and make them available as public constant state variables</div>
<div class="line">Note: This transformations initializes those state variables with address 0, which is a placeholder. 0 is replaced with the               real address upon deployment.</div>
</div>
</li>
<li><p>Transform state variable declarations with owner != &#64;all (replace type by cipher type)</p></li>
<li><p>For every function and constructor, the parameters and the body are transformed using the transformers defined in zkay_transformer.py</p></li>
</ul>
<p>To support verification, the functions themselves also need additional transformations:</p>
<p>In the original zkay paper, all the circuit out parameters + the proof are added as additional parameters for all functions which
require verification.
This makes it impossible to simply call another function, since every function expects its out arguments + a proof.</p>
<p>Zkay 2.0 uses an improved design, with the goal of supporting function calls in an elegant way.
It is based on the following observations:</p>
<ol class="arabic simple">
<li><p>zk proof verification is only possible in functions which are called externally via a transaction,
as it requires offchain simulation to generate a valid zero knowledge proof.</p></li>
<li><p>public functions can be called externally (transaction) as well as internally (called from other function)</p></li>
<li><p>private and internal functions can only be called internally</p></li>
<li><p>public functions which have private arguments, but don’t contain any private expressions in their body (e.g. because they only
contain assignments, which are public operations as long as the owner does not change), only need verification if they are called
externally (since then the parameters are user supplied and thus their encryption needs to be verified)</p></li>
<li><p>The difference between an external and an internal function can be reduced to argument encryption verification +
proof verification via verification contract invocation</p></li>
</ol>
<p>From 1) follows, that the externally called function must also handle the verification of all transitively called functions
Observations 2), 4) and 5) suggest, that it is sensible to split each public function into two different parts:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>An internal function which has the original function body and arguments</p></li>
<li><p>An external function which does argument verification, calls the internal function and finally and invokes the verification contract
(=&gt; “External Wrapper function”)</p></li>
</ol>
</div></blockquote>
<p>This way, calling a public function from within another function works exactly the same as calling a private/internal function,
zkay simply has to reroute the call to the internal function.
It also means, that no resources are wasted when calling a function such as mentioned in 4) from another function, since in that case
the internal function does not require verification.</p>
<p>What’s left is how to deal with 1). Zkay 2.0 uses the following solution:</p>
<ul>
<li><div class="line-block">
<div class="line">If a function is purely public (no private arguments, no private expressions in itself or any transitively called functions)</div>
<div class="line">=&gt; No change in signature and no additional transformations</div>
</div>
</li>
<li><p>If an internal function requires verification (+), 4 additional arguments are added to its signature:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>a variable length array where public circuit inputs generated by this function should be stored</p></li>
<li><p>a start index which determines at which index this function should start storing circuit inputs into the in array</p></li>
<li><p>a variable length array containing public circuit outputs required in this function</p></li>
<li><p>a start index which determines where in the uint array the out values for the current function call are located</p></li>
</ol>
</div></blockquote>
<ul class="simple">
<li><p>A struct definition is added to the contract definition, which includes entries for every circuit and input variable with correct types.</p></li>
<li><p>At the beginning of the internal function, a variable of that struct type is declared and all circuit output variables from the out array         parameter are deserialized into the struct.</p></li>
<li><p>Within the function body, all circuit inputs are stored into the struct and outputs are read from the struct.</p></li>
<li><p>At the end of the internal function, all circuit input variables in the struct are serialized into the in array parameter.</p></li>
</ul>
<p>When a function calls another function which requires verification, the start indices for in and out array are advanced such that
they point to the correct sections and the in/out arrays + new start indices are added to the arguments of the call.
If the called function does not require verification, it is simply called without any additional arguments.</p>
<div class="line-block">
<div class="line">(+) An internal function requires verification if it contains private expressions.</div>
<div class="line-block">
<div class="line"><em>Note</em>: a function body can contain private variables (!= &#64;all) without containing private expressions,                   since assignment of encrypted variables with the same owner is a public operation.</div>
</div>
</div>
</li>
<li><p>If a function is an external wrapper, 2 additional arguments are added to its signature:</p>
<blockquote>
<div><ol class="arabic">
<li><p>a variable length array containing public circuit outputs for the function itself and all transitively called functions
If we have a call hierarchy like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">f</span><span class="p">():</span>
    <span class="n">calls</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">which</span> <span class="n">calls</span> <span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">calls</span> <span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>then the layout in the output array (same for the input array defined below) will be: f outs | g outs | h outs | h outs
(i.e. the current functions circuit outputs come first, followed by those of the called functions in the function call order
(according to AST traversal order))</p>
</li>
<li><p>a zero knowledge proof</p></li>
</ol>
</div></blockquote>
<ul class="simple">
<li><p>At the beginning of the external wrapper function a dynamic array is allocated which is large enough to store all circuit inputs
from all transitively called functions.</p></li>
<li><p>Next all encrypted arguments are stored in the in array (since the circuit will verify the encryption)</p></li>
<li><p>Then the wrapper requests all statically known public keys (key for me or for a final address state variable), required by any
of the transitively called functions, and also stores them in the in array.</p></li>
<li><p>The corresponding internal function is then called.
If it requires verification, the newly allocated in array + the out array parameter + initial start indices
(0 for out array, after last key for in array) are added as additional arguments.</p></li>
<li><p>Finally the verification contract is invoked to verify the proof (the in array was populated by the called functions themselves).</p></li>
</ul>
</li>
</ul>
<dl class="py attribute">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.circuits">
<span class="sig-name descname"><span class="pre">circuits</span></span><em class="property"><span class="w"> </span><span class="pre">:Dict[zkay.zkay_ast.ast.ConstructorOrFunctionDefinition,</span> <span class="pre">zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper]</span></em><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.circuits" title="Permalink to this definition"></a></dt>
<dd><p>Abstract circuits for all functions which require verification</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.var_decl_trafo">
<span class="sig-name descname"><span class="pre">var_decl_trafo</span></span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.var_decl_trafo" title="Permalink to this definition"></a></dt>
<dd><p>Transformer for state variable declarations and parameters</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.import_contract">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">import_contract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cname</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">su</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.SourceUnit" title="zkay.zkay_ast.ast.SourceUnit"><span class="pre">zkay.zkay_ast.ast.SourceUnit</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">corresponding_circuit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../circuit_generation/circuit_helper/index.html#zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper" title="zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper"><span class="pre">zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.import_contract" title="Permalink to this definition"></a></dt>
<dd><p>Import contract ‘vname’ into the given source unit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cname</strong> – contract name (.sol filename stem must match contract type name)</p></li>
<li><p><strong>su</strong> – [SIDE EFFECT] source unit where contract should be imported</p></li>
<li><p><strong>corresponding_circuit</strong> – [SIDE EFFECT] if contract is a verification contract, this should be the corresponding circuit helper</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.create_contract_variable">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_contract_variable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cname</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.StateVariableDeclaration" title="zkay.zkay_ast.ast.StateVariableDeclaration"><span class="pre">zkay.zkay_ast.ast.StateVariableDeclaration</span></a></span></span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.create_contract_variable" title="Permalink to this definition"></a></dt>
<dd><p>Create a public constant state variable with which contract with name ‘cname’ can be accessed</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.include_verification_contracts">
<span class="sig-name descname"><span class="pre">include_verification_contracts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">su</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.SourceUnit" title="zkay.zkay_ast.ast.SourceUnit"><span class="pre">zkay.zkay_ast.ast.SourceUnit</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">c</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ContractDefinition" title="zkay.zkay_ast.ast.ContractDefinition"><span class="pre">zkay.zkay_ast.ast.ContractDefinition</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.StateVariableDeclaration" title="zkay.zkay_ast.ast.StateVariableDeclaration"><span class="pre">zkay.zkay_ast.ast.StateVariableDeclaration</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.include_verification_contracts" title="Permalink to this definition"></a></dt>
<dd><p>Import all verification contracts for ‘c’ into ‘su’ and create state variable declarations for all of them + the pki contract.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>su</strong> – [SIDE EFFECT] source unit into which contracts should be imported</p></li>
<li><p><strong>c</strong> – contract for which verification contracts should be imported</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of all constant state variable declarations for the pki contract + all the verification contracts</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.create_circuit_helper">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_circuit_helper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fct</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ConstructorOrFunctionDefinition" title="zkay.zkay_ast.ast.ConstructorOrFunctionDefinition"><span class="pre">zkay.zkay_ast.ast.ConstructorOrFunctionDefinition</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_owners</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">zkay.zkay_ast.ast.PrivacyLabelExpr</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">internal_circ</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../circuit_generation/circuit_helper/index.html#zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper" title="zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper"><span class="pre">zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.create_circuit_helper" title="Permalink to this definition"></a></dt>
<dd><p>Create circuit helper for the given function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fct</strong> – function for which to create a circuit</p></li>
<li><p><strong>global_owners</strong> – list of all statically known privacy labels (me + final address state variables)</p></li>
<li><p><strong>internal_circ</strong> – the circuit of the internal function on which to base this circuit
(only used when creating the circuit of the external wrapper function)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>new circuit helper</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.visitSourceUnit">
<span class="sig-name descname"><span class="pre">visitSourceUnit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ast</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.SourceUnit" title="zkay.zkay_ast.ast.SourceUnit"><span class="pre">zkay.zkay_ast.ast.SourceUnit</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.visitSourceUnit" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.transform_contract">
<span class="sig-name descname"><span class="pre">transform_contract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">su</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.SourceUnit" title="zkay.zkay_ast.ast.SourceUnit"><span class="pre">zkay.zkay_ast.ast.SourceUnit</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">c</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ContractDefinition" title="zkay.zkay_ast.ast.ContractDefinition"><span class="pre">zkay.zkay_ast.ast.ContractDefinition</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ContractDefinition" title="zkay.zkay_ast.ast.ContractDefinition"><span class="pre">zkay.zkay_ast.ast.ContractDefinition</span></a></span></span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.transform_contract" title="Permalink to this definition"></a></dt>
<dd><p>Transform an entire zkay contract into a public solidity contract.</p>
<p>This:</p>
<ul class="simple">
<li><p>transforms state variables, function bodies and signatures</p></li>
<li><p>import verification contracts</p></li>
<li><p>adds zk_data structs for each function with verification           (to store circuit I/O, to bypass solidity stack limit and allow for easy assignment of array variables),</p></li>
<li><p>creates external wrapper functions for all public functions which require verification</p></li>
<li><p>adds circuit IO serialization/deserialization code from/to zk_data struct to all functions which require verification.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>su</strong> – [SIDE EFFECTS] Source unit of which this contract is part of</p></li>
<li><p><strong>c</strong> – [SIDE EFFECTS] The contract to transform</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The contract itself</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.create_internal_verification_wrapper">
<span class="sig-name descname"><span class="pre">create_internal_verification_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ast</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ConstructorOrFunctionDefinition" title="zkay.zkay_ast.ast.ConstructorOrFunctionDefinition"><span class="pre">zkay.zkay_ast.ast.ConstructorOrFunctionDefinition</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.create_internal_verification_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>Add the necessary additional parameters and boiler plate code for verification support to the given function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ast</strong> – [SIDE EFFECT] Internal function which requires verification</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.split_into_external_and_internal_fct">
<span class="sig-name descname"><span class="pre">split_into_external_and_internal_fct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ConstructorOrFunctionDefinition" title="zkay.zkay_ast.ast.ConstructorOrFunctionDefinition"><span class="pre">zkay.zkay_ast.ast.ConstructorOrFunctionDefinition</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.Parameter" title="zkay.zkay_ast.ast.Parameter"><span class="pre">zkay.zkay_ast.ast.Parameter</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_owners</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">zkay.zkay_ast.ast.PrivacyLabelExpr</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ConstructorOrFunctionDefinition" title="zkay.zkay_ast.ast.ConstructorOrFunctionDefinition"><span class="pre">zkay.zkay_ast.ast.ConstructorOrFunctionDefinition</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ConstructorOrFunctionDefinition" title="zkay.zkay_ast.ast.ConstructorOrFunctionDefinition"><span class="pre">zkay.zkay_ast.ast.ConstructorOrFunctionDefinition</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.split_into_external_and_internal_fct" title="Permalink to this definition"></a></dt>
<dd><p>Take public function f and split it into an internal function and an external wrapper function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> – [SIDE EFFECT] function to split (at least requires_verification_if_external)</p></li>
<li><p><strong>original_params</strong> – list of transformed function parameters without additional parameters added due to transformation</p></li>
<li><p><strong>global_owners</strong> – list of static labels (me + final address state variable identifiers)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tuple of newly created external and internal function definitions</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.create_external_wrapper_body">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_external_wrapper_body</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">int_fct</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.ConstructorOrFunctionDefinition" title="zkay.zkay_ast.ast.ConstructorOrFunctionDefinition"><span class="pre">zkay.zkay_ast.ast.ConstructorOrFunctionDefinition</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext_circuit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../circuit_generation/circuit_helper/index.html#zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper" title="zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper"><span class="pre">zkay.compiler.privacy.circuit_generation.circuit_helper.CircuitHelper</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.Parameter" title="zkay.zkay_ast.ast.Parameter"><span class="pre">zkay.zkay_ast.ast.Parameter</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">requires_proof</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../../../../zkay_ast/ast/index.html#zkay.zkay_ast.ast.Block" title="zkay.zkay_ast.ast.Block"><span class="pre">zkay.zkay_ast.ast.Block</span></a></span></span><a class="headerlink" href="#zkay.compiler.privacy.transformation.zkay_contract_transformer.ZkayTransformer.create_external_wrapper_body" title="Permalink to this definition"></a></dt>
<dd><p>Return Block with external wrapper function body.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>int_fct</strong> – corresponding internal function</p></li>
<li><p><strong>ext_circuit</strong> – [SIDE EFFECT] circuit helper of the external wrapper function</p></li>
<li><p><strong>original_params</strong> – list of transformed function parameters without additional parameters added due to transformation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>body with wrapper code</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2021, Nick Baumann, Roger Baumgartner, Benjamin Bichsel, Samuel Steffen, SRI Lab ETH Zurich.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>